<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Generate Public Key - DTC</title>
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f5f6fa; padding: 1.3em; max-width: 480px; margin: 0 auto;}
    h1 { color: #219150; text-align: center; margin-bottom: 1.2em; font-size: 1.15em;}
    .form-group { margin-bottom: 1em; }
    label { font-weight: bold; color: #2d3c35; margin-bottom: 0.35em; display:block;}

    /* Container for input and toggle icon */
    .input-with-toggle {
      position: relative;
      width: 100%;
    }

    input[type="password"], input[type="text"], .pubkey-box {
      width: 100%; padding: 11px 12px; font-size: 1em; border: 2px solid #cfd8dc;
      border-radius: 9px; box-sizing: border-box; background: #fff;
      margin-top: 0.13em; transition: border 0.15s;
      padding-right: 40px; /* Make space for the eye icon */
    }
    input:focus { border-color: #ffd600; background: #ffffed; }
    input.valid { border-color: #43a047;}
    input.invalid { border-color: #e53935;}
    
    /* Eye icon styling */
    .eye-icon {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: #90a4ae;
      width: 20px;
      height: 20px;
      transition: color 0.15s;
      margin-top: 0.13em; /* Align with input margin-top */
    }
    .eye-icon:hover {
      color: #546e7a;
    }

    .pubkey-box {
      background: #eafaf0; color: #222; margin-top: 1.05em;
      font-family: 'Courier New', monospace; min-height: 39px; font-size: 0.98em;
      border-color: #219150; display: flex; align-items: center; justify-content: space-between;
      transition: border 0.18s;
      padding: 10px 12px;
      word-break: break-all; /* Allow long text to break */
    }
    .pubkey-box.copied { border-color: #43a047; background: #f0fff0;}
    .copy-btn {
      background: #2196f3; color: #fff; border: none; border-radius: 8px;
      padding: 6px 14px; font-size: 0.95em; cursor: pointer; font-weight: bold; margin-left: 10px;
    }
    .copy-btn:active { filter: brightness(0.95);}
    .copy-status { color: #43a047; font-size: 0.97em; margin-left: 8px; opacity: 0; transition: opacity 0.18s;}
    .copy-status.visible { opacity: 1;}
    .strength-bar { height: 7px; width: 100%; margin-top: 4px; border-radius: 5px; background: #f5f5f5; overflow: hidden;}
    .strength-inner { height: 100%; width: 0; border-radius: 5px; transition: width 0.22s;}
    .btn-gen {
      width: 100%; background: #2196f3; color: #fff; border: none; border-radius: 8px;
      padding: 11px 0; font-size: 1.08em; font-weight: bold; margin-top: 0.7em; cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.09); transition: background 0.13s;
    }
    .btn-gen:active { background: #1976d2;}
    .btn-gen:disabled { opacity: 0.6; cursor: not-allowed;}
    @media (max-width: 600px) {
      body { padding: 1em 0.08em;}
      h1 { font-size: 1em;}
      .copy-btn { padding: 5px 9px;}
      .pubkey-box { font-size: 0.93em;}
      .btn-gen { padding: 10px 0;}
    }
  </style>
</head>
<body>
  <h1>Generate Public Key (DTC)</h1>
  <div class="form-group">
    <label for="password">Password</label>
    <div class="input-with-toggle">
      <input type="password" id="password" maxlength="12" autocomplete="new-password" placeholder="6-12 chars (a-z,0-9)"/>
      <svg class="eye-icon" data-target="password" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 4.5c-4.42 0-8.22 2.81-9.56 6.8-.15.49-.15 1.01 0 1.5C3.78 16.69 7.58 19.5 12 19.5s8.22-2.81 9.56-6.8c.15-.49.15-1.01 0-1.5C20.22 7.31 16.42 4.5 12 4.5zm0 13c-2.48 0-4.5-2.02-4.5-4.5S9.52 8.5 12 8.5s4.5 2.02 4.5 4.5-2.02 4.5-4.5 4.5zm0-7.5c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
      </svg>
    </div>
    <div class="strength-bar"><div id="pw-strength" class="strength-inner"></div></div>
  </div>
  <div class="form-group">
    <label for="confirmPassword">Confirm Password</label>
    <div class="input-with-toggle">
      <input type="password" id="confirmPassword" maxlength="12" autocomplete="new-password" placeholder="Confirm"/>
      <svg class="eye-icon" data-target="confirmPassword" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 4.5c-4.42 0-8.22 2.81-9.56 6.8-.15.49-.15 1.01 0 1.5C3.78 16.69 7.58 19.5 12 19.5s8.22-2.81 9.56-6.8c.15-.49.15-1.01 0-1.5C20.22 7.31 16.42 4.5 12 4.5zm0 13c-2.48 0-4.5-2.02-4.5-4.5S9.52 8.5 12 8.5s4.5 2.02 4.5 4.5-2.02 4.5-4.5 4.5zm0-7.5c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
      </svg>
    </div>
  </div>
  <div class="form-group">
    <label for="pin">PIN</label>
    <div class="input-with-toggle">
      <input type="password" id="pin" maxlength="4" pattern="\d*" inputmode="numeric" placeholder="4 digits (0-9)"/>
      <svg class="eye-icon" data-target="pin" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 4.5c-4.42 0-8.22 2.81-9.56 6.8-.15.49-.15 1.01 0 1.5C3.78 16.69 7.58 19.5 12 19.5s8.22-2.81 9.56-6.8c.15-.49.15-1.01 0-1.5C20.22 7.31 16.42 4.5 12 4.5zm0 13c-2.48 0-4.5-2.02-4.5-4.5S9.52 8.5 12 8.5s4.5 2.02 4.5 4.5-2.02 4.5-4.5 4.5zm0-7.5c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
      </svg>
    </div>
  </div>
  <div class="form-group">
    <label for="confirmPin">Confirm PIN</label>
    <div class="input-with-toggle">
      <input type="password" id="confirmPin" maxlength="4" pattern="\d*" inputmode="numeric" placeholder="Confirm"/>
      <svg class="eye-icon" data-target="confirmPin" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 4.5c-4.42 0-8.22 2.81-9.56 6.8-.15.49-.15 1.01 0 1.5C3.78 16.69 7.58 19.5 12 19.5s8.22-2.81 9.56-6.8c.15-.49.15-1.01 0-1.5C20.22 7.31 16.42 4.5 12 4.5zm0 13c-2.48 0-4.5-2.02-4.5-4.5S9.52 8.5 12 8.5s4.5 2.02 4.5 4.5-2.02 4.5-4.5 4.5zm0-7.5c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
      </svg>
    </div>
  </div>
  <button class="btn-gen" id="generateBtn">Generate Public Key</button>
  <div class="form-group" id="pubkeyArea" style="display:none;">
    <div class="pubkey-box" id="pubkeyBox">
      <span id="publicKeyPlaceholder">Public Key will appear here</span>
      <button class="copy-btn" id="copyBtn">Copy</button>
      <span id="copyStatus" class="copy-status"></span>
    </div>
  </div>
  <script>
    // Function to validate password format
    function validPw(pw) {
      return /^[a-zA-Z0-9]{6,12}$/.test(pw);
    }

    // Function to validate PIN format
    function validPin(pin) {
      return /^\d{4}$/.test(pin);
    }
    
    // Function to generate the key (now returns password + pin)
    function genKey(password, pin) {
      return password + pin;
    }

    // Function to calculate password strength
    function pwStrength(pw) {
      if(!pw) return 0;
      let s = 0;
      if(pw.length >= 6) s++;
      if(/[A-Z]/.test(pw)) s++;
      if(/[a-z]/.test(pw)) s++;
      if(/\d/.test(pw)) s++;
      if(pw.length > 9) s++;
      return Math.min(s, 4);
    }

    // Function to update the password strength bar
    function updateStrength() {
      const pw = document.getElementById('password').value;
      const bar = document.getElementById('pw-strength');
      const lvl = pwStrength(pw);
      bar.style.width = (25 * lvl) + '%';
      bar.style.background = lvl >= 4 ? '#43a047' : lvl >= 3 ? '#ffd600' : lvl ? '#ffa726' : '#eee';
    }

    // Function to apply feedback (valid/invalid) to input fields
    function feedback(id, isValid) {
      const input = document.getElementById(id);
      if(isValid === true) {
        input.classList.add('valid');
        input.classList.remove('invalid');
      } else if(isValid === false) {
        input.classList.remove('valid');
        input.classList.add('invalid');
      } else {
        input.classList.remove('valid','invalid'); // Reset state
      }
    }

    // Main validation function for all inputs
    function validateInputs() {
      const pw = document.getElementById('password').value.trim();
      const cpw = document.getElementById('confirmPassword').value.trim();
      const pin = document.getElementById('pin').value.trim();
      const cpin = document.getElementById('confirmPin').value.trim();

      const isPwValid = validPw(pw);
      // Check if confirm password matches password AND is valid format
      const isCpwMatching = (cpw.length > 0 && cpw === pw && isPwValid);
      const isPinValid = validPin(pin);
      // Check if confirm PIN matches PIN AND is valid format
      const isCpinMatching = (cpin.length > 0 && cpin === pin && isPinValid);

      feedback('password', isPwValid);
      feedback('confirmPassword', isCpwMatching);
      feedback('pin', isPinValid);
      feedback('confirmPin', isCpinMatching);
      
      updateStrength();

      // Enable/disable generate button based on all validations
      const generateBtn = document.getElementById('generateBtn');
      if (isPwValid && isCpwMatching && isPinValid && isCpinMatching) {
        generateBtn.disabled = false;
      } else {
        generateBtn.disabled = true;
      }

      return (isPwValid && isCpwMatching && isPinValid && isCpinMatching);
    }

    // Toggle password/PIN visibility
    document.querySelectorAll('.eye-icon').forEach(icon => {
      icon.addEventListener('click', function() {
        const targetId = this.dataset.target;
        const input = document.getElementById(targetId);
        if (input.type === 'password') {
          input.type = 'text';
          // You could change the SVG path here for an 'eye-slash' icon if desired
          this.innerHTML = '<path d="M12 4.5c-4.42 0-8.22 2.81-9.56 6.8-.15.49-.15 1.01 0 1.5C3.78 16.69 7.58 19.5 12 19.5s8.22-2.81 9.56-6.8c.15-.49.15-1.01 0-1.5C20.22 7.31 16.42 4.5 12 4.5zm0 13c-2.48 0-4.5-2.02-4.5-4.5S9.52 8.5 12 8.5s4.5 2.02 4.5 4.5-2.02 4.5-4.5 4.5zm0-7.5c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 1.66.41 3.25 1.14 4.67L19.33 3.14A9.95 9.95 0 0 1 22 12zM12 20c-1.66 0-3.25-.41-4.67-1.14L3.14 19.33A9.95 9.95 0 0 1 2 12c0-5.52 4.48-10 10-10s10 4.48 10 10-4.48 10-10 10zM12 5.5c-3.59 0-6.68 2.06-8.24 5H20.24c-1.56-2.94-4.65-5-8.24-5z">'; // Example 'eye-slash' path
        } else {
          input.type = 'password';
          this.innerHTML = '<path d="M12 4.5c-4.42 0-8.22 2.81-9.56 6.8-.15.49-.15 1.01 0 1.5C3.78 16.69 7.58 19.5 12 19.5s8.22-2.81 9.56-6.8c.15-.49.15-1.01 0-1.5C20.22 7.31 16.42 4.5 12 4.5zm0 13c-2.48 0-4.5-2.02-4.5-4.5S9.52 8.5 12 8.5s4.5 2.02 4.5 4.5-2.02 4.5-4.5 4.5zm0-7.5c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>'; // Original 'eye' path
        }
      });
    });

    // Attach input event listeners to all relevant fields
    ['password','confirmPassword','pin','confirmPin'].forEach(id => {
      document.getElementById(id).addEventListener('input', validateInputs);
    });

    document.getElementById('generateBtn').onclick = function() {
      if (!validateInputs()) {
        // If validation fails, do not proceed.
        return;
      }
      const pw = document.getElementById('password').value.trim();
      const pin = document.getElementById('pin').value.trim();
      
      // Get the combined string for display
      let combinedValue = genKey(pw, pin); 
      
      document.getElementById('publicKeyPlaceholder').textContent = combinedValue;
      document.getElementById('pubkeyArea').style.display = '';
    };

    document.getElementById('copyBtn').onclick = function() {
      const textToCopy = document.getElementById('publicKeyPlaceholder').textContent;
      // Using document.execCommand('copy') for better compatibility in iframe environments
      const textarea = document.createElement('textarea');
      textarea.value = textToCopy;
      document.body.appendChild(textarea);
      textarea.select();
      try {
        document.execCommand('copy');
        const pubkeyBox = document.getElementById('pubkeyBox');
        const copyStatus = document.getElementById('copyStatus');
        copyStatus.textContent = '✓ Copied!';
        copyStatus.classList.add('visible');
        pubkeyBox.classList.add('copied');
        setTimeout(()=>{
          copyStatus.classList.remove('visible'); 
          pubkeyBox.classList.remove('copied');
        }, 1100);
      } catch (err) {
        console.error('Failed to copy text: ', err);
        // Optionally, inform the user that copying failed
      } finally {
        document.body.removeChild(textarea);
      }
    };

    // Initial validation call to set button state and feedback
    validateInputs();
  </script>
</body>
</html>
